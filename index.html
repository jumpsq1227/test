<!DOCTYPE html>
<html lang="ja">
<head><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta charset="UTF-8">
<title>A1 German Quiz</title>
<style>
  #options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    max-width: 600px;
    margin-top: 10px;
  }
  #options button {
    padding: 25px;
    font-size: 1.0rem;
    cursor: pointer;
    height: 60px;
    border-radius: 8px;
    border: 1px solid #333;
    transition: background-color 0.3s;
  }
  #startBtn {
    font-size: 1.5rem;   /* 文字サイズを大きく */
    padding: 15px 30px;  /* 上下15px、左右30pxの余白 */
    height: 70px;         /* ボタン高さ */
    width: 100%;          /* 画面幅いっぱいに広げる */
    border-radius: 10px;  /* 角丸 */
    border: 1px solid #333;
    cursor: pointer;
    margin-bottom: 20px;  /* 下の余白 */
    background-color: #4626d4;
    color: white;
    transition: background-color 0.3s;
  }
  #startBtn:hover {
    background-color: #45a049; /* ホバーで少し色を変化 */
  }
  #quiz {
    font-size: 1.6rem;       /* 文字サイズを大きく */
    font-weight: bold;       /* 太字 */
    margin-bottom: 15px;     /* 下に余白 */
  }
</style>
</head>
<body>
<h1>A1 German Quiz</h1>

<label><input type="radio" name="mode" value="jp2de" checked> 日本語 → ドイツ語</label>
<label><input type="radio" name="mode" value="de2jp"> ドイツ語 → 日本語</label>
<br><br>

<button id="startBtn">クイズ出題</button>
<div id="quiz"></div>
<div id="options"></div>
<div id="result"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
let words = [];

// CSV読み込み
async function loadCSV() {
  try {
    const response = await fetch("words.csv");
    const text = await response.text();
    const result = Papa.parse(text, {header:true, skipEmptyLines:true});
    words = result.data;
    console.log("Loaded words:", words);
  } catch (error) {
    console.error("CSV読み込みエラー:", error);
  }
}

// シャッフル関数
function shuffle(array) { return array.sort(()=>Math.random()-0.5); }

// 選択肢生成
function generateOptions(correct, key, articleKey) {
  let opts = [correct];
  while (opts.length < 4) {
    const rand = words[Math.floor(Math.random()*words.length)];
    let val;
    if(key==="Wort") val = `${rand[articleKey]} ${rand[key]}`.trim();
    else val = rand[key];
    if(!opts.includes(val)) opts.push(val);
  }
  return shuffle(opts);
}

// クイズ開始
function startQuiz() {
  if(words.length < 4) { alert("words.csv に最低4単語必要です"); return; }

  const mode = document.querySelector("input[name='mode']:checked").value;
  const randomWord = words[Math.floor(Math.random()*words.length)];

  let question, correctAnswer, options;
  if(mode==="jp2de"){
    question = `${randomWord.Translation}`;
    correctAnswer = `${randomWord.Artikel} ${randomWord.Wort}`.trim();
    options = generateOptions(correctAnswer,"Wort","Artikel");
  } else {
    question = `${randomWord.Artikel} ${randomWord.Wort}`;
    correctAnswer = randomWord.Translation;
    options = generateOptions(correctAnswer,"Translation");
  }

  document.getElementById("quiz").textContent = question;
  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML = "";
  options.forEach(opt=>{
    const btn = document.createElement("button");
    btn.textContent = opt;
    btn.onclick = ()=>checkAnswer(btn,opt,correctAnswer);
    optionsDiv.appendChild(btn);
  });

  document.getElementById("result").textContent = "";
}

// 回答チェック（色変更）
function checkAnswer(btn, answer, correct) {
  if(answer===correct){
    btn.style.backgroundColor = "lightgreen";
    document.getElementById("result").textContent = "正解🎉";
  } else {
    btn.style.backgroundColor = "salmon";
    document.getElementById("result").textContent = `不正解😥 正しい答えは「${correct}」です。`;
  }
}

// イベント
document.getElementById("startBtn").addEventListener("click", startQuiz);
loadCSV();
</script>
</body>
</html>
