<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>A1 German Quiz 4æŠ</title>
<style>
  #options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    max-width: 400px;
  }
  #options button {
    padding: 10px;
    font-size: 1rem;
    cursor: pointer;
  }
</style>
</head>
<body>
<h1>A1 German Quiz</h1>

<label><input type="radio" name="mode" value="jp2de" checked> æ—¥æœ¬èª â†’ ãƒ‰ã‚¤ãƒ„èª</label>
<label><input type="radio" name="mode" value="de2jp"> ãƒ‰ã‚¤ãƒ„èª â†’ æ—¥æœ¬èª</label>
<br><br>

<button id="startBtn">ã‚¯ã‚¤ã‚ºé–‹å§‹</button>
<div id="quiz"></div>
<div id="options"></div>
<div id="result"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
let words = [];

// CSVèª­ã¿è¾¼ã¿
async function loadCSV() {
  try {
    const response = await fetch("words.csv");
    const text = await response.text();
    const result = Papa.parse(text, {header:true, skipEmptyLines:true});
    words = result.data;
    console.log("Loaded words:", words);
  } catch (error) {
    console.error("CSVèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:", error);
  }
}

// ã‚·ãƒ£ãƒƒãƒ•ãƒ«é–¢æ•°
function shuffle(array) { return array.sort(()=>Math.random()-0.5); }

// é¸æŠè‚¢ç”Ÿæˆ
function generateOptions(correct, key, articleKey) {
  let opts = [correct];
  while (opts.length < 4) {
    const rand = words[Math.floor(Math.random()*words.length)];
    let val;
    if(key==="Wort") val = `${rand[articleKey]} ${rand[key]}`.trim();
    else val = rand[key];
    if(!opts.includes(val)) opts.push(val);
  }
  return shuffle(opts);
}

// ã‚¯ã‚¤ã‚ºé–‹å§‹
function startQuiz() {
  if(words.length < 4) { alert("words.csv ã«æœ€ä½4å˜èªå¿…è¦ã§ã™"); return; }

  const mode = document.querySelector("input[name='mode']:checked").value;
  const randomWord = words[Math.floor(Math.random()*words.length)];

  let question, correctAnswer, options;
  if(mode==="jp2de"){
    question = `ã€Œ${randomWord.Translation}ã€ã«å½“ãŸã‚‹ãƒ‰ã‚¤ãƒ„èªã¯ã©ã‚Œï¼Ÿ`;
    correctAnswer = `${randomWord.Artikel} ${randomWord.Wort}`.trim();
    options = generateOptions(correctAnswer,"Wort","Artikel");
  } else {
    question = `Wort: ${randomWord.Artikel} ${randomWord.Wort}`;
    correctAnswer = randomWord.Translation;
    options = generateOptions(correctAnswer,"Translation");
  }

  document.getElementById("quiz").textContent = question;
  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML = "";
  options.forEach(opt=>{
    const btn = document.createElement("button");
    btn.textContent = opt;
    btn.onclick = ()=>checkAnswer(btn,opt,correctAnswer);
    optionsDiv.appendChild(btn);
  });

  document.getElementById("result").textContent = "";
}

// å›ç­”ãƒã‚§ãƒƒã‚¯ï¼ˆè‰²å¤‰æ›´ï¼‰
function checkAnswer(btn, answer, correct) {
  if(answer===correct){
    btn.style.backgroundColor = "lightgreen";
    document.getElementById("result").textContent = "æ­£è§£ï¼ ğŸ‰";
  } else {
    btn.style.backgroundColor = "salmon";
    document.getElementById("result").textContent = `ä¸æ­£è§£ã€‚æ­£ã—ã„ç­”ãˆã¯ã€Œ${correct}ã€ã§ã™ã€‚`;
  }
}

// ã‚¤ãƒ™ãƒ³ãƒˆ
document.getElementById("startBtn").addEventListener("click", startQuiz);
loadCSV();
</script>
</body>
</html>
