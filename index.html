<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>A1 German Quiz</title>
</head>
<body>
  <h1>A1 German Quiz</h1>

  <label>
    <input type="radio" name="mode" value="jp2de" checked> æ—¥æœ¬èª â†’ ãƒ‰ã‚¤ãƒ„èª
  </label>
  <label>
    <input type="radio" name="mode" value="de2jp"> ãƒ‰ã‚¤ãƒ„èª â†’ æ—¥æœ¬èª
  </label>
  <br><br>

  <button id="startBtn">ã‚¯ã‚¤ã‚ºé–‹å§‹</button>
  <div id="quiz"></div>
  <div id="result"></div>

  <script>
    let words = [];

    // CSVã‚’èª­ã¿è¾¼ã‚€
    async function loadCSV() {
      try {
        const response = await fetch("words.csv");
        const text = await response.text();
        words = parseCSV(text);
        console.log("Loaded words:", words);
      } catch (error) {
        console.error("CSVèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:", error);
      }
    }

    // CSVã‚’ãƒ‘ãƒ¼ã‚¹
    function parseCSV(text) {
      const lines = text.trim().split("\n");
      const headers = lines[0].split(",");
      return lines.slice(1).map(line => {
        const values = line.split(",");
        let obj = {};
        headers.forEach((h, i) => {
          obj[h.trim()] = values[i] ? values[i].trim() : "";
        });
        return obj;
      });
    }

    // ã‚¯ã‚¤ã‚ºé–‹å§‹
    function startQuiz() {
      if (words.length < 4) {
        alert("æœ€ä½4å˜èªä»¥ä¸Šã®words.csvã‚’ç”¨æ„ã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      const mode = document.querySelector("input[name='mode']:checked").value;
      const randomWord = words[Math.floor(Math.random() * words.length)];

      let question, correctAnswer, options;
      if (mode === "jp2de") {
        question = `ã€Œ${randomWord.Meaning}ã€ã«å½“ãŸã‚‹ãƒ‰ã‚¤ãƒ„èªã¯ã©ã‚Œï¼Ÿ`;
        correctAnswer = `${randomWord.Article} ${randomWord.German}`.trim();
        options = generateOptions(correctAnswer, "German", "Article");
      } else {
        question = `ã€Œ${randomWord.German}ã€(${randomWord.PartOfSpeech}, ${randomWord.Article}) ã®æ„å‘³ã¯ï¼Ÿ`;
        correctAnswer = randomWord.Meaning;
        options = generateOptions(correctAnswer, "Meaning");
      }

      const quizDiv = document.getElementById("quiz");
      quizDiv.innerHTML = `<p>${question}</p>`;
      options.forEach(opt => {
        quizDiv.innerHTML += `
          <button onclick="checkAnswer('${correctAnswer}','${opt}')">${opt}</button><br>
        `;
      });
    }

    // é¸æŠè‚¢ã‚’ä½œã‚‹
    function generateOptions(correct, key, articleKey) {
      let opts = [correct];
      while (opts.length < 4) {
        const rand = words[Math.floor(Math.random() * words.length)];
        let val;
        if (key === "German") {
          val = `${rand[articleKey]} ${rand[key]}`.trim();
        } else {
          val = rand[key];
        }
        if (!opts.includes(val)) {
          opts.push(val);
        }
      }
      return shuffle(opts);
    }

    // é…åˆ—ã‚·ãƒ£ãƒƒãƒ•ãƒ«
    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    // å›ç­”ãƒã‚§ãƒƒã‚¯
    function checkAnswer(correct, answer) {
      const resultDiv = document.getElementById("result");
      if (answer === correct) {
        resultDiv.textContent = "æ­£è§£ï¼ ğŸ‰";
      } else {
        resultDiv.textContent = `ä¸æ­£è§£ã€‚æ­£ã—ã„ç­”ãˆã¯ã€Œ${correct}ã€ã§ã™ã€‚`;
      }
    }

    document.getElementById("startBtn").addEventListener("click", startQuiz);

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«CSVã‚’ãƒ­ãƒ¼ãƒ‰
    loadCSV();
  </script>
</body>
</html>
