<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>A1 German Quiz</title>
</head>
<body>
  <h1>A1 German Quiz</h1>

  <label>
    <input type="radio" name="mode" value="jp2de" checked> æ—¥æœ¬èª â†’ ãƒ‰ã‚¤ãƒ„èª
  </label>
  <label>
    <input type="radio" name="mode" value="de2jp"> ãƒ‰ã‚¤ãƒ„èª â†’ æ—¥æœ¬èª
  </label>
  <br><br>

  <button id="startBtn">ã‚¯ã‚¤ã‚ºé–‹å§‹</button>
  <div id="quiz"></div>
  <div id="result"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script>
    let words = [];

    // CSVã‚’èª­ã¿è¾¼ã‚€
    async function loadCSV() {
      try {
        const response = await fetch("words.csv");
        const text = await response.text();
        // PapaParseã§å®‰å…¨ã«CSVãƒ‘ãƒ¼ã‚¹ï¼ˆã‚«ãƒ³ãƒã‚„å¼•ç”¨ç¬¦å¯¾å¿œï¼‰
        const result = Papa.parse(text, {header: true, skipEmptyLines: true});
        words = result.data;
        console.log("Loaded words:", words);
      } catch (error) {
        console.error("CSVèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:", error);
      }
    }

    function startQuiz() {
      if (words.length < 4) {
        alert("æœ€ä½4å˜èªä»¥ä¸Šã®words.csvã‚’ç”¨æ„ã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      const mode = document.querySelector("input[name='mode']:checked").value;
      const randomWord = words[Math.floor(Math.random() * words.length)];

      let question, correctAnswer, options;
      if (mode === "jp2de") {
        question = `ã€Œ${randomWord.Translation}ã€ã«å½“ãŸã‚‹ãƒ‰ã‚¤ãƒ„èªã¯ã©ã‚Œï¼Ÿ`;
        correctAnswer = `${randomWord.Artikle} ${randomWord.Wort}`.trim();
        options = generateOptions(correctAnswer, "German", "Article");
      } else {
        question = `ã€Œ${randomWord.Wort}ã€(${randomWord.PartOfSpeech}, ${randomWord.Artikle}) ã®æ„å‘³ã¯ï¼Ÿ`;
        correctAnswer = randomWord.Translation;
        options = generateOptions(correctAnswer, "Translation");
      }

      const quizDiv = document.getElementById("quiz");
      quizDiv.innerHTML = `<p>${question}</p>`;
      options.forEach(opt => {
        quizDiv.innerHTML += `<button onclick="checkAnswer('${correctAnswer}','${opt}')">${opt}</button><br>`;
      });
    }

    function generateOptions(correct, key, articleKey) {
      let opts = [correct];
      while (opts.length < 4) {
        const rand = words[Math.floor(Math.random() * words.length)];
        let val;
        if (key === "German") {
          val = `${rand[articleKey]} ${rand[key]}`.trim();
        } else {
          val = rand[key];
        }
        if (!opts.includes(val)) {
          opts.push(val);
        }
      }
      return shuffle(opts);
    }

    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    function checkAnswer(correct, answer) {
      const resultDiv = document.getElementById("result");
      if (answer === correct) {
        resultDiv.textContent = "æ­£è§£ï¼ ğŸ‰";
      } else {
        resultDiv.textContent = `ä¸æ­£è§£ã€‚æ­£ã—ã„ç­”ãˆã¯ã€Œ${correct}ã€ã§ã™ã€‚`;
      }
    }

    document.getElementById("startBtn").addEventListener("click", startQuiz);
    loadCSV();
  </script>
</body>
</html>
