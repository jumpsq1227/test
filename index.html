<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>A1 German Quiz</title>
</head>
<body>
  <h1>A1 German Quiz</h1>

  <label>
    <input type="radio" name="mode" value="jp2de" checked> 日本語 → ドイツ語
  </label>
  <label>
    <input type="radio" name="mode" value="de2jp"> ドイツ語 → 日本語
  </label>
  <br><br>

  <button id="startBtn">クイズ開始</button>
  <div id="quiz"></div>
  <div id="result"></div>

  <script>
    let words = [];

    // CSVを読み込む
    async function loadCSV() {
      try {
        const response = await fetch("words.csv");
        const text = await response.text();
        words = parseCSV(text);
        console.log("Loaded words:", words);
      } catch (error) {
        console.error("CSV読み込みエラー:", error);
      }
    }

    // CSVをパース
    function parseCSV(text) {
      const lines = text.trim().split("\n");
      const headers = lines[0].split(",");
      return lines.slice(1).map(line => {
        const values = line.split(",");
        let obj = {};
        headers.forEach((h, i) => {
          obj[h.trim()] = values[i] ? values[i].trim() : "";
        });
        return obj;
      });
    }

    // クイズ開始
    function startQuiz() {
      if (words.length < 4) {
        alert("最低4単語以上のwords.csvを用意してください。");
        return;
      }

      const mode = document.querySelector("input[name='mode']:checked").value;
      const randomWord = words[Math.floor(Math.random() * words.length)];

      let question, correctAnswer, options;
      if (mode === "jp2de") {
        question = `「${randomWord.Meaning}」に当たるドイツ語はどれ？`;
        correctAnswer = `${randomWord.Article} ${randomWord.German}`.trim();
        options = generateOptions(correctAnswer, "German", "Article");
      } else {
        question = `「${randomWord.German}」(${randomWord.PartOfSpeech}, ${randomWord.Article}) の意味は？`;
        correctAnswer = randomWord.Meaning;
        options = generateOptions(correctAnswer, "Meaning");
      }

      const quizDiv = document.getElementById("quiz");
      quizDiv.innerHTML = `<p>${question}</p>`;
      options.forEach(opt => {
        quizDiv.innerHTML += `
          <button onclick="checkAnswer('${correctAnswer}','${opt}')">${opt}</button><br>
        `;
      });
    }

    // 選択肢を作る
    function generateOptions(correct, key, articleKey) {
      let opts = [correct];
      while (opts.length < 4) {
        const rand = words[Math.floor(Math.random() * words.length)];
        let val;
        if (key === "German") {
          val = `${rand[articleKey]} ${rand[key]}`.trim();
        } else {
          val = rand[key];
        }
        if (!opts.includes(val)) {
          opts.push(val);
        }
      }
      return shuffle(opts);
    }

    // 配列シャッフル
    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    // 回答チェック
    function checkAnswer(correct, answer) {
      const resultDiv = document.getElementById("result");
      if (answer === correct) {
        resultDiv.textContent = "正解！ 🎉";
      } else {
        resultDiv.textContent = `不正解。正しい答えは「${correct}」です。`;
      }
    }

    document.getElementById("startBtn").addEventListener("click", startQuiz);

    // ページ読み込み時にCSVをロード
    loadCSV();
  </script>
</body>
</html>
